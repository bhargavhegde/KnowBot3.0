# üß† KnowBot 3.0: Master Project Briefing

**ID:** `knowbot-3.0-radial-demo`  
**Owner:** Bhargav Hegde  
**Status:** Production-Ready & Optimized  

---

## üöÄ 1. Executive Summary
KnowBot 3.0 is a high-fidelity, private RAG (Retrieval-Augmented Generation) Knowledge Assistant. It is designed to demonstrate full-stack AI engineering, specifically focusing on data isolation, semantic retrieval, and premium UI/UX.

---

## üèóÔ∏è 2. System Architecture & Infrastructure

### **Hosting: Railway.app**
*   **Project Name:** `mindful-creation`
*   **Project ID:** `af06bd05-337a-443c-af31-41ed631d5649`
*   **Backend Service:** `e16766f7-1092-4864-bd5d-ed976cf8c816`
*   **Environment:** Production (`fd755d40-b6b2-4111-8061-9820e9e178ad`)
*   **Frontend URL:** [https://knowbot30-production.up.railway.app](https://knowbot30-production.up.railway.app)
*   **Backend API:** [https://knowbot30-production.up.railway.app/api/](https://knowbot30-production.up.railway.app/api/)

### **The Stack**
*   **Frontend:** Next.js 15 (App Router), Tailwind CSS, Framer Motion, Axios for API.
*   **Backend:** Django 5.0 + Django REST Framework.
*   **Database:** PostgreSQL (Cloud-hosted for state/history).
*   **Vector DB:** ChromaDB (Local persistent client within container).
*   **Task Queue:** Celery + Redis (for async indexing).
*   **AI Engine:** LangChain orchestration.
*   **LLM Provider:** Groq (Llama-3.3-70b-versatile) for Production; Ollama (Llama-3.1) for Local.

---

## üõ†Ô∏è 3. Key Implementations

### **A. RAG Strategy (The "Brain")**
*   **Chunking:** 800-character chunks with 150-character overlap.
*   **Hybrid Search:** Fuses **Semantic (Vector)** and **Keyword (BM25)** retrieval (60/40 weight) to handle both natural language and specific technical terms.
*   **Data Isolation:** Metadata filtering ensures `user_id` strictly partitions ChromaDB.

### **B. Thinking Stream & UI**
*   **Thinking Steps:** Backend sends a JSON array of `steps` (e.g., "Retrieving documents...", "Synthesizing answer...") which the frontend renders in a real-time "Thinking Stream" component.
*   **Animated Bot:** A huge (320px) central robot avatar (`BrainAvatar`) with reactive expressions (happy/skeptical/surprised) using Framer Motion.

### **C. Dynamic Suggestions**
*   The system generates exactly **3 follow-up questions** after every response.
*   **Knowledge-Reactive:** When a document finishes indexing in the sidebar, a hook triggers `fetchInitialSuggestions` to update the "Quick Start" questions on the home screen immediately.

---

## ü™µ 4. Historical Challenges & Critical Fixes

### **üö® Challenge: The "Ephemeral Storage" Data Loss**
*   **Problem:** Files uploaded to Railway disappeared after every redeploy. 
*   **Fix:** Acknowledged the stateless nature of containers. In a real production scale, we would use S3 for blobs and a managed Vector DB. Currently handled via documentation in `talking_points.md` for interview explanation.

### **üö® Challenge: SIGKILL (Out of Memory) on Railway**
*   **Problem:** Gunicorn workers were crashing (OOM) during heavy AI tasks.
*   **Fix:** 
    1. Reduced Gunicorn workers from `2` to `1` in `railway.json`.
    2. Optimized `RAGEngine` to remove redundant chain initializations.
    3. Switched Tavily search depth to `basic` to reduce JSON payload size.

### **üö® Challenge: CSRF Verification Failure**
*   **Problem:** Admin login failed on the `.up.railway.app` domain.
*   **Fix:** Manually added the production domain to `CSRF_TRUSTED_ORIGINS` and `ALLOWED_HOSTS` in `settings.py`.

### **üö® Challenge: Suggestion Consistency**
*   **Problem:** LLMs occasionally returned only 1 question instead of 3.
*   **Fix:** Hard-coded prompt constraints for "EXACTLY 3" and added a Python fallback to pad the list with defaults if the LLM fails.

---

## üîß 5. Maintenance & CLI Cheat Sheet

### **Local Setup**
*   Requires `postgresql-client` installed via `apt-get`.
*   Connect to prod DB: `railway connect` (then select Postgres).

### **Nuke Command (Wipe all data)**
To restart the demo for a new interviewer:
1.  **CLI:** `PGPASSWORD=[pwd] psql -h [host] -p [port] -U postgres -d railway -c "DROP SCHEMA public CASCADE; CREATE SCHEMA public;"`
2.  **Redeploy:** `railway up` to rebuild tables.

### **Admin Access**
1.  SSH in: `railway ssh --project=... --service=...`
2.  Create user: `python manage.py createsuperuser`

---

## üìÇ 6. Important Files
*   `backend/rag/service.py`: The heart of the AI logic.
*   `frontend/src/context/ChatContext.tsx`: Main frontend state.
*   `notes/talking_points.md`: Interview-ready "Problem/Solution" scenarios.
*   `railway.json`: Production deployment config.

---
*Generated by Antigravity on 2026-02-07*
